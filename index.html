<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.cdnfonts.com/css/atkinson-hyperlegible" rel="stylesheet">
    <title>Carbon Footprint Calculator</title>
    <link rel="stylesheet" href="./style.css" />
</head>
<body>
    <h1>Carbon Footprint Estimator</h1>
    <div class="inline-field">
        <p>Select the time length of your lifestyle estimates:</p>
        <select id="timeframe">
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
        </select>
    </div>
    <h2>Transportation</h2>
        <div id="transportEntriesContainer"></div>
        <div style="margin-top: 0.5em; text-align: center;">
            <button type="button" class="button" onclick="addTransportEntry()">Add mode of transport</button>
        </div>

    <h2>Diet</h2>
    <label for="diet">Select your weekly diet:</label>
    <select id="diet" onchange="updateFoodFootprint()">
        <option value="steak_only">Steak Only</option>
        <option value="high_meat">High Meat Eater</option>
        <option value="average">Average</option>
        <option value="pescitarian_w_s">Pescitarian w/ shrimp</option>
        <option value="pescitarian_wo_s">Pescitarian w/o shrimp</option>
        <option value="vegetarian">Vegetarian</option>
        <option value="vegan">Vegan</option>
    </select>
    <h2>Composting</h2>
    <div class="inline-field">
        <label for="bread">Bread (kg composted):</label>
        <label for="produce">Produce (kg composted):</label>
        <label for="meat">Meat (kg composted):</label>
    </div>
    <div class="inline-field">
        <input type="number" id="bread" />
        <input type="number" id="produce" />
        <input type="number" id="meat" />
    </div>
    <button class="button" onclick="calculate()">Calculate Footprint</button>
    
    <div id="result"></div>
    <script>
    // Transport entries management
    let transportEntries = [];
    let nextTransportId = 1;
    function addTransportEntry() {
        const container = document.getElementById("transportEntriesContainer");
        const id = nextTransportId++;
        
        // Default entry object
        const entry = {
            id,
            mode: "car",
            distance: 0,
            fuelEfficiency: 0
        };
        transportEntries.push(entry);

        const entryDiv = document.createElement("div");
        entryDiv.className = "transport-entry";
        entryDiv.id = `transport-${id}`;
        entryDiv.innerHTML = `
            <label>Mode:
                <select onchange="updateTransportMode(${id}, this.value)">
                    <option value="car">Car</option>
                    <option value="bus">Bus</option>
                    <option value="train">Train</option>
                    <option value="bike">Bicycle</option>
                    <option value="walk">Walking</option>
                </select>
            </label>
            <label>Distance (km):
                <input type="number" onchange="updateTransportDistance(${id}, this.value)">
            </label>
            <label id="fuel-eff-${id}">Fuel Efficiency (L/100km):
                <input type="number" onchange="updateTransportFuel(${id}, this.value)">
            </label>
            <button type="button" class="button" onclick="removeTransportEntry(${id})">Remove</button>
            <hr/>
        `;
        container.appendChild(entryDiv);
    }

    //Keep your array in sync with the UI
    function updateTransportMode(id, mode) {
    const entry = transportEntries.find(e => e.id === id);
    if (entry) entry.mode = mode;

    const fuelLabel = document.getElementById(`fuel-eff-${id}`);
    fuelLabel.style.display = mode === "car" ? "inline-block" : "none";
}

    function updateTransportDistance(id, value) {
        const entry = transportEntries.find(e => e.id === id);
        if (entry) entry.distance = parseFloat(value) || 0;
    }

    function updateTransportFuel(id, value) {
        const entry = transportEntries.find(e => e.id === id);
        if (entry) entry.fuelEfficiency = parseFloat(value) || 0;
    }

    function removeTransportEntry(id) {
        transportEntries = transportEntries.filter(e => e.id !== id);
        const entryDiv = document.getElementById(`transport-${id}`);
        if (entryDiv) entryDiv.remove();
    }

    function updateTransportInputs() {
        const transportType = document.getElementById("transportType").value;
        const carInputs = document.getElementById("carInputs");
        if (transportType === "car") {
            carInputs.style.display = "block";
        } else {
            carInputs.style.display = "none";
        }
    }

    function calculate() {
        const bread = parseFloat(document.getElementById("bread").value) || 0;
        const produce = parseFloat(document.getElementById("produce").value) || 0;
        const meat = parseFloat(document.getElementById("meat").value) || 0;
        const dietValue = document.getElementById("diet").value;
        const timeframe = document.getElementById("timeframe").value;

        // Emissions factors in kg CO2e per km (approximate values)
        const emissionsPerKm = {
            bus: 0.105,   // average bus
            train: 0.041, // average train
            bike: 0,      // bike
            walk: 0       // walk
        };
        
        let transportEmissions = 0;

        for (const entry of transportEntries) {
            const km = entry.distance || 0;

            if (entry.mode === "car") {
                const litersUsed = (km / 100) * (entry.fuelEfficiency || 0);
                transportEmissions += litersUsed * 2.31;
            } else {
                transportEmissions += (emissionsPerKm[entry.mode] || 0) * km;
            }
        }

        // Composting benefit: methane avoided (CH4), converted to CO2e over 100 years
        const CH4_BREAD = 0.375;
        const CH4_PRODUCE = 0.25;
        const CH4_MEAT = 0.7;
        const ESCAPE_FACTOR = 0.61; // 61% escapes
        const GWP_100yr = 28;

        const compostCH4 = (bread * CH4_BREAD + produce * CH4_PRODUCE 
            + meat * CH4_MEAT) * ESCAPE_FACTOR;

        let compostAvoidedCO2e = compostCH4 * GWP_100yr;

        //Diet
        const dietEmissionsMap = {
            steak_only: 336,
            high_meat: 40,
            average: 25,
            pescitarian_w_s: 22,
            pescitarian_wo_s: 18,
            vegetarian: 15,
            vegan: 12
        };
        let dietC02e = dietEmissionsMap[dietValue] || 0;

        // Apply timeframe multiplier
        let multiplier = 1;
        if (timeframe === "monthly") {
            multiplier = 4.345;
        } else if (timeframe === "yearly") {
            multiplier = 52;
        }
        compostAvoidedCO2e *= multiplier;
        dietC02e *= multiplier;

        document.getElementById("result").innerHTML = `
            Emissions from transportation: <strong>${transportEmissions.toFixed(2)} kg CO₂e</strong><br/>
            Emissions avoided by composting: <strong>${compostAvoidedCO2e.toFixed(2)} kg CO₂e</strong><br/>
            Emissions from diet: <strong>${dietC02e.toFixed(2)} kg CO₂e</strong>
        `;
    }  
    function updateFoodFootprint() {
        const diet = document.getElementById("diet").value;
        const foodOutput = document.getElementById("foodOutput");
        const timeframe = document.getElementById("timeframe").value;
        let emissions = 0;
        switch(diet){
            //TODO: do research about actual values
            case "steak_only":
                emissions = 336; //kg C02e per week
                break;
            case "high_meat":
                emissions = 40; //kg C02e per week
                break;
            case "average":
                emissions = 25; //kg C02e per week
                break;
            case "pescitarian_w_shrimp":
                emissions = 22; //kg C02e per week
                break;
            case "pescitarian_wo_shrimp":
                emissions = 18; //kg C02e per week
                break;
            case "vegetarian":
                emissions = 15; //kg C02e per week
                break;
            case "vegan":
                emissions = 12; //kg C02e per week
                break;
        }
        let multiplier = 1;
        if (timeframe === "monthly") {
            multiplier = 4.345; // average weeks per month
        } else if (timeframe === "yearly") {
            multiplier = 52;
        }
        foodOutput.textContent = (emissions * multiplier).toFixed(2);
    }

    function updateKmDrivenTimeframe() {
        const timeframe = document.getElementById("timeframe").value;
        let text = "week";
        if (timeframe === "monthly") text = "month";
        else if (timeframe === "yearly") text = "year";
        document.getElementById("kmDrivenTimeframe").textContent = text;
    }

    document.getElementById("timeframe").addEventListener("change", function() {
        updateKmDrivenTimeframe();
        updateFoodFootprint();
    });
    document.getElementById("transportType").addEventListener("change", function() {
        updateTransportInputs();
    });

    // Call on page load
    updateKmDrivenTimeframe();
    updateTransportInputs();
    </script>
</body>
</html>